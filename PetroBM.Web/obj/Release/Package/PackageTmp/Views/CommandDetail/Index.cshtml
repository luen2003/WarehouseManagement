@model PetroBM.Web.Models.CommandDetailModel
@using PagedList.Mvc;
@using PetroBM.Common.Util;


@{
    ViewBag.Title = "Kho " + Session[Constants.Session_WareHouseName] + " > Danh sách lệnh theo ngăn";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@using (Html.BeginForm("Index", "CommandDetail", FormMethod.Post, new { @id = "Form1" }))
{
    var alert = TempData["AlertMessage"];
    if (null != alert && !string.IsNullOrEmpty(alert.ToString()))
    {
        <div class="alert alert-success alert-dismissable">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            <strong>@alert</strong>
        </div>
    }
    <div class="container">
        <div class='col-sm-4 col-xs-6'>
            <div class="row">
                <label class="control-label col-xs-4">Số chứng từ</label>
                <div class="form-group col-xs-8">
                    @Html.EditorFor(model => model.CertificateNumber, new { htmlAttributes = new { @class = "form-control" } })
                </div>
            </div>
            @*<div class="row">
                    <label class="control-label col-xs-4">Card data</label>
                    <div class="form-group col-xs-8">
                        @Html.EditorFor(model => model.CardData, new { htmlAttributes = new { @class = "form-control" } })
                    </div>
                </div>*@

            <div class="row">
                <label class="control-label col-xs-4">Card serial</label>
                <div class="form-group col-xs-8">
                    @Html.EditorFor(model => model.CardSerial, new { htmlAttributes = new { @class = "form-control" } })
                </div>
            </div>
            <div class="row">
                <label class="control-label col-xs-4">Trạng thái ngăn</label>
                <div class="form-group col-xs-6">
                    <select id="Flag" class="form-control" name="Status">
                        @switch (Model.Status)
                        {
                            case null:
                                <option value="" selected="selected">Tất cả</option>
                                <option value="99">Đăng ký lệnh</option>
                                <option value="0">Đã duyệt lệnh</option>
                                <option value="1">Chuẩn bị xuất</option>
                                <option value="2">Đang xuất hàng</option>
                                <option value="3">Xuất xong</option>
                                <option value="4">Dừng ép</option>
                                @*<option value="5">Hủy lệnh</option>
                                <option value="6">Nhập tay</option>
                                <option value="7">Niêm chì</option>*@
                                <option value="8">Đã in phiếu</option>
                                <option value="9">Chuyển ngày</option>
                                break;
                            case 99:
                                <option value="">Tất cả</option>
                                <option value="99" selected="selected">Đăng ký lệnh</option>
                                <option value="0">Đã duyệt lệnh</option>
                                <option value="1">Chuẩn bị xuất</option>
                                <option value="2">Đang xuất hàng</option>
                                <option value="3">Xuất xong</option>
                                <option value="4">Dừng ép</option>
                                @*<option value="5">Hủy lệnh</option>
                                <option value="6">Nhập tay</option>
                                <option value="7">Niêm chì</option>*@
                                <option value="8">Đã in phiếu</option>
                                <option value="9">Chuyển ngày</option>
                                break;
                            case 0:
                                <option value="">Tất cả</option>
                                <option value="99">Đăng ký lệnh</option>
                                <option value="0" selected="selected">Đã duyệt lệnh</option>
                                <option value="1">Chuẩn bị xuất</option>
                                <option value="2">Đang xuất hàng</option>
                                <option value="3">Xuất xong</option>
                                <option value="4">Dừng ép</option>
                                @*<option value="5">Hủy lệnh</option>
                                <option value="6">Nhập tay</option>
                                <option value="7">Niêm chì</option>*@
                                <option value="8">Đã in phiếu</option>
                                <option value="9">Chuyển ngày</option>
                                break;
                            case 1:
                                <option value="">Tất cả</option>
                                <option value="99">Đăng ký lệnh</option>
                                <option value="0">Đã duyệt lệnh</option>
                                <option value="1" selected="selected">Chuẩn bị xuất</option>
                                <option value="2">Đang xuất hàng</option>
                                <option value="3">Xuất xong</option>
                                <option value="4">Dừng ép</option>
                                @*<option value="5">Hủy lệnh</option>
                                <option value="6">Nhập tay</option>
                                <option value="7">Niêm chì</option>*@
                                <option value="8">Đã in phiếu</option>
                                <option value="9">Chuyển ngày</option>
                                break;
                            case 2:
                                <option value="">Tất cả</option>
                                <option value="99">Đăng ký lệnh</option>
                                <option value="0">Đã duyệt lệnh</option>
                                <option value="1">Chuẩn bị xuất</option>
                                <option value="2" selected="selected">Đang xuất hàng</option>
                                <option value="3">Xuất xong</option>
                                <option value="4">Dừng ép</option>
                                @*<option value="5">Hủy lệnh</option>
                                <option value="6">Nhập tay</option>
                                <option value="7">Niêm chì</option>*@
                                <option value="8">Đã in phiếu</option>
                                <option value="9">Chuyển ngày</option>
                                break;
                            case 3:
                                <option value="">Tất cả</option>
                                <option value="99">Đăng ký lệnh</option>
                                <option value="0">Đã duyệt lệnh</option>
                                <option value="1">Chuẩn bị xuất</option>
                                <option value="2">Đang xuất hàng</option>
                                <option value="3" selected="selected">Xuất xong</option>
                                <option value="4">Dừng ép</option>
                                @*<option value="5">Hủy lệnh</option>
                                <option value="6">Nhập tay</option>
                                <option value="7">Niêm chì</option>*@
                                <option value="8">Đã in phiếu</option>
                                <option value="9">Chuyển ngày</option>
                                break;
                            case 4:
                                <option value="">Tất cả</option>
                                <option value="99">Đăng ký lệnh</option>
                                <option value="0">Đã duyệt lệnh</option>
                                <option value="1">Chuẩn bị xuất</option>
                                <option value="2">Đang xuất hàng</option>
                                <option value="3">Xuất xong</option>
                                <option value="4" selected="selected">Dừng ép</option>
                                @*<option value="5">Hủy lệnh</option>
                                <option value="6">Nhập tay</option>
                                <option value="7">Niêm chì</option>*@
                                <option value="8">Đã in phiếu</option>
                                <option value="9">Chuyển ngày</option>
                                break;
                            case 5:
                                <option value="">Tất cả</option>
                                <option value="99">Đăng ký lệnh</option>
                                <option value="0">Đã duyệt lệnh</option>
                                <option value="1">Chuẩn bị xuất</option>
                                <option value="2">Đang xuất hàng</option>
                                <option value="3">Xuất xong</option>
                                <option value="4">Dừng ép</option>
                                @*<option value="5" selected="selected">Hủy lệnh</option>
                                <option value="6">Nhập tay</option>
                                <option value="7">Niêm chì</option>*@
                                <option value="8">Đã in phiếu</option>
                                <option value="9">Chuyển ngày</option>
                                break;
                            case 6:
                                <option value="">Tất cả</option>
                                <option value="99">Đăng ký lệnh</option>
                                <option value="0">Đã duyệt lệnh</option>
                                <option value="1">Chuẩn bị xuất</option>
                                <option value="2">Đang xuất hàng</option>
                                <option value="3">Xuất xong</option>
                                <option value="4">Dừng ép</option>
                                @*<option value="5">Hủy lệnh</option>
                                <option value="6" selected="selected">Nhập tay</option>
                                <option value="7">Niêm chì</option>*@
                                <option value="8">Đã in phiếu</option>
                                <option value="9">Chuyển ngày</option>
                                break;
                            case 7:
                                <option value="">Tất cả</option>
                                <option value="99">Đăng ký lệnh</option>
                                <option value="0">Đã duyệt lệnh</option>
                                <option value="1">Chuẩn bị xuất</option>
                                <option value="2">Đang xuất hàng</option>
                                <option value="3">Xuất xong</option>
                                <option value="4">Dừng ép</option>
                                @*<option value="5">Hủy lệnh</option>
                                <option value="6">Nhập tay</option>
                                <option value="7" selected="selected">Niêm chì</option>*@
                                <option value="8">Đã in phiếu</option>
                                <option value="9">Chuyển ngày</option>
                                break;
                            case 8:
                                <option value="">Tất cả</option>
                                <option value="99">Đăng ký lệnh</option>
                                <option value="0">Đã duyệt lệnh</option>
                                <option value="1">Chuẩn bị xuất</option>
                                <option value="2">Đang xuất hàng</option>
                                <option value="3">Xuất xong</option>
                                <option value="4">Dừng ép</option>
                                @*<option value="5">Hủy lệnh</option>
                                <option value="6">Nhập tay</option>
                                <option value="7">Niêm chì</option>*@
                                <option value="8" selected="selected">Đã in phiếu</option>
                                <option value="9">Chuyển ngày</option>
                                break;
                            case 9:
                                <option value="">Tất cả</option>
                                <option value="99">Đăng ký lệnh</option>
                                <option value="0">Đã duyệt lệnh</option>
                                <option value="1">Chuẩn bị xuất</option>
                                <option value="2">Đang xuất hàng</option>
                                <option value="3">Xuất xong</option>
                                <option value="4">Dừng ép</option>
                                @*<option value="5">Hủy lệnh</option>
                                <option value="6">Nhập tay</option>
                                <option value="7">Niêm chì</option>*@
                                <option value="8">Đã in phiếu</option>
                                <option value="9" selected="selected">Chuyển ngày</option>
                                break;
                        }
                    </select>
                </div>
            </div>
        </div>

        <div class='col-sm-5 col-xs-6'>
            <div class="row">
                <label class="control-label col-xs-4">Thời gian đăng ký</label>
                <div class="form-group col-xs-6">
                    <div class='input-group date' id='datetimepicker1'>
                        @Html.EditorFor(model => model.StartDate, new { htmlAttributes = new { @class = "form-control" } })
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
                    </div>
                </div>
            </div>
            <div class="row">
                <label class="control-label col-xs-4">Phương tiện</label>
                <div class="form-group col-xs-8">
                    <select style="width:200px" class="form-control" name="VerhicleNumber">
                        @foreach (var item in Model.ListVehicle)
                        {
                            if (Model.VerhicleNumber == item.VehicleNumber)
                            {
                                <option selected="selected" value="@item.VehicleNumber">@item.VehicleNumber</option>
                            }
                            else
                            {
                                <option value="@item.VehicleNumber">@item.VehicleNumber</option>
                            }
                        }
                        @if (Model.VerhicleNumber == "")
                        {
                            <option selected="selected" value="">Tất cả</option>
                        }
                        else
                        {
                            <option value="">Tất cả</option>
                        }
                    </select>

                </div>
            </div>

            <div class="row">
                <label class="control-label col-xs-4">Họng</label>
                <div class="form-group col-xs-8">
                    @if (Model.ListConfigArm.Any())
                    {
                        @Html.DropDownListFor(model => model.ArmNo,
                new SelectList(Model.ListConfigArm, "ArmNo", "ArmName", "") as SelectList, "Tất cả",
                new { @class = "form-control", @style = "width:200px;" })
                    }
                    else
                    {
                        @Html.DropDownListFor(model => model.ArmNo,
                new SelectList(new List<string>()), "Chọn... ",
                new { @class = "form-control", @style = "width:200px;" })
                    }

                </div>
            </div>
            @*<div class="row">
                    <label class="control-label col-xs-4">Trạng thái ngăn</label>
                    <div class="form-group col-xs-6">
                        <select id="Flag" class="form-control" name="Status">
                            @switch (Model.Status)
                            {
                                case null:
                                    <option value="" selected="selected">Tất cả</option>
                                    <option value="99">Đăng ký lệnh</option>
                                    <option value="0">Đã duyệt lệnh</option>
                                    <option value="1">Chuẩn bị xuất</option>
                                    <option value="2">Đang xuất hàng</option>
                                    <option value="3">Xuất xong</option>
                                    <option value="4">Dừng ép</option>
                                    <option value="5">Hủy lệnh</option>
                                    <option value="6">Nhập tay</option>
                                    <option value="7">Niêm chì</option>
                                    <option value="8">Xuất hóa đơn</option>
                                    <option value="9">Chuyển ngày</option>
                                    break;
                                case 99:
                                    <option value="">Tất cả</option>
                                    <option value="99" selected="selected">Đăng ký lệnh</option>
                                    <option value="0">Đã duyệt lệnh</option>
                                    <option value="1">Chuẩn bị xuất</option>
                                    <option value="2">Đang xuất hàng</option>
                                    <option value="3">Xuất xong</option>
                                    <option value="4">Dừng ép</option>
                                    <option value="5">Hủy lệnh</option>
                                    <option value="6">Nhập tay</option>
                                    <option value="7">Niêm chì</option>
                                    <option value="8">Xuất hóa đơn</option>
                                    <option value="9">Chuyển ngày</option>
                                    break;
                                case 0:
                                    <option value="">Tất cả</option>
                                    <option value="99">Đăng ký lệnh</option>
                                    <option value="0" selected="selected">Đã duyệt lệnh</option>
                                    <option value="1">Chuẩn bị xuất</option>
                                    <option value="2">Đang xuất hàng</option>
                                    <option value="3">Xuất xong</option>
                                    <option value="4">Dừng ép</option>
                                    <option value="5">Hủy lệnh</option>
                                    <option value="6">Nhập tay</option>
                                    <option value="7">Niêm chì</option>
                                    <option value="8">Xuất hóa đơn</option>
                                    <option value="9">Chuyển ngày</option>
                                    break;
                                case 1:
                                    <option value="">Tất cả</option>
                                    <option value="99">Đăng ký lệnh</option>
                                    <option value="0">Đã duyệt lệnh</option>
                                    <option value="1" selected="selected">Chuẩn bị xuất</option>
                                    <option value="2">Đang xuất hàng</option>
                                    <option value="3">Xuất xong</option>
                                    <option value="4">Dừng ép</option>
                                    <option value="5">Hủy lệnh</option>
                                    <option value="6">Nhập tay</option>
                                    <option value="7">Niêm chì</option>
                                    <option value="8">Xuất hóa đơn</option>
                                    <option value="9">Chuyển ngày</option>
                                    break;
                                case 2:
                                    <option value="">Tất cả</option>
                                    <option value="99">Đăng ký lệnh</option>
                                    <option value="0">Đã duyệt lệnh</option>
                                    <option value="1">Chuẩn bị xuất</option>
                                    <option value="2" selected="selected">Đang xuất hàng</option>
                                    <option value="3">Xuất xong</option>
                                    <option value="4">Dừng ép</option>
                                    <option value="5">Hủy lệnh</option>
                                    <option value="6">Nhập tay</option>
                                    <option value="7">Niêm chì</option>
                                    <option value="8">Xuất hóa đơn</option>
                                    <option value="9">Chuyển ngày</option>
                                    break;
                                case 3:
                                    <option value="">Tất cả</option>
                                    <option value="99">Đăng ký lệnh</option>
                                    <option value="0">Đã duyệt lệnh</option>
                                    <option value="1">Chuẩn bị xuất</option>
                                    <option value="2">Đang xuất hàng</option>
                                    <option value="3" selected="selected">Xuất xong</option>
                                    <option value="4">Dừng ép</option>
                                    <option value="5">Hủy lệnh</option>
                                    <option value="6">Nhập tay</option>
                                    <option value="7">Niêm chì</option>
                                    <option value="8">Xuất hóa đơn</option>
                                    <option value="9">Chuyển ngày</option>
                                    break;
                                case 4:
                                    <option value="">Tất cả</option>
                                    <option value="99">Đăng ký lệnh</option>
                                    <option value="0">Đã duyệt lệnh</option>
                                    <option value="1">Chuẩn bị xuất</option>
                                    <option value="2">Đang xuất hàng</option>
                                    <option value="3">Xuất xong</option>
                                    <option value="4" selected="selected">Dừng ép</option>
                                    <option value="5">Hủy lệnh</option>
                                    <option value="6">Nhập tay</option>
                                    <option value="7">Niêm chì</option>
                                    <option value="8">Xuất hóa đơn</option>
                                    <option value="9">Chuyển ngày</option>
                                    break;
                                case 5:
                                    <option value="">Tất cả</option>
                                    <option value="99">Đăng ký lệnh</option>
                                    <option value="0">Đã duyệt lệnh</option>
                                    <option value="1">Chuẩn bị xuất</option>
                                    <option value="2">Đang xuất hàng</option>
                                    <option value="3">Xuất xong</option>
                                    <option value="4">Dừng ép</option>
                                    <option value="5" selected="selected">Hủy lệnh</option>
                                    <option value="6">Nhập tay</option>
                                    <option value="7">Niêm chì</option>
                                    <option value="8">Xuất hóa đơn</option>
                                    <option value="9">Chuyển ngày</option>
                                    break;
                                case 6:
                                    <option value="">Tất cả</option>
                                    <option value="99">Đăng ký lệnh</option>
                                    <option value="0">Đã duyệt lệnh</option>
                                    <option value="1">Chuẩn bị xuất</option>
                                    <option value="2">Đang xuất hàng</option>
                                    <option value="3">Xuất xong</option>
                                    <option value="4">Dừng ép</option>
                                    <option value="5">Hủy lệnh</option>
                                    <option value="6" selected="selected">Nhập tay</option>
                                    <option value="7">Niêm chì</option>
                                    <option value="8">Xuất hóa đơn</option>
                                    <option value="9">Chuyển ngày</option>
                                    break;
                                case 7:
                                    <option value="">Tất cả</option>
                                    <option value="99">Đăng ký lệnh</option>
                                    <option value="0">Đã duyệt lệnh</option>
                                    <option value="1">Chuẩn bị xuất</option>
                                    <option value="2">Đang xuất hàng</option>
                                    <option value="3">Xuất xong</option>
                                    <option value="4">Dừng ép</option>
                                    <option value="5">Hủy lệnh</option>
                                    <option value="6">Nhập tay</option>
                                    <option value="7" selected="selected">Niêm chì</option>
                                    <option value="8">Xuất hóa đơn</option>
                                    <option value="9">Chuyển ngày</option>
                                    break;
                                case 8:
                                    <option value="">Tất cả</option>
                                    <option value="99">Đăng ký lệnh</option>
                                    <option value="0">Đã duyệt lệnh</option>
                                    <option value="1">Chuẩn bị xuất</option>
                                    <option value="2">Đang xuất hàng</option>
                                    <option value="3">Xuất xong</option>
                                    <option value="4">Dừng ép</option>
                                    <option value="5">Hủy lệnh</option>
                                    <option value="6">Nhập tay</option>
                                    <option value="7">Niêm chì</option>
                                    <option value="8" selected="selected">Xuất hóa đơn</option>
                                    <option value="9">Chuyển ngày</option>
                                    break;
                                case 9:
                                    <option value="">Tất cả</option>
                                    <option value="99">Đăng ký lệnh</option>
                                    <option value="0">Đã duyệt lệnh</option>
                                    <option value="1">Chuẩn bị xuất</option>
                                    <option value="2">Đang xuất hàng</option>
                                    <option value="3">Xuất xong</option>
                                    <option value="4">Dừng ép</option>
                                    <option value="5">Hủy lệnh</option>
                                    <option value="6">Nhập tay</option>
                                    <option value="7">Niêm chì</option>
                                    <option value="8">Xuất hóa đơn</option>
                                    <option value="9" selected="selected">Chuyển ngày</option>
                                    break;
                            }
                        </select>
                    </div>
                </div>*@
        </div>
        <div class='col-sm-3 col-xs-6'>
            <div class="row">
                <div class="form-group col-xs-10">
                    <div class='input-group date' id='datetimepicker2'>
                        @Html.EditorFor(model => model.EndDate, new { htmlAttributes = new { @class = "form-control" } })
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>

                    </div>
                </div>
            </div>
            <div class="row">
                &nbsp;
            </div>
            <div class="row" style="padding-left:15px;padding-top:30px;">
                <button type="submit" class='btn btn-success'>Tìm kiếm</button>
            </div>
        </div>
        <table class="table">
            <thead>
                <tr>

                    <th>
                        Khách hàng
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.CommandDetail.Vehicle)
                    </th>
                    <th>
                        Lái xe
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.CommandDetail.CertificateNumber)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.CommandDetail.CardData)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.CommandDetail.CardSerial)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.CommandDetail.ProductName)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.CommandDetail.ArmNo)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.CommandDetail.CompartmentOrder)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.CommandDetail.V_Preset)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.CommandDetail.V_Actual)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.CommandDetail.AvgTemperature)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.CommandDetail.Flag)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.CommandDetail.CommandFlag)
                    </th>
                    <th></th>
                </tr>
            </thead>

            @foreach (var item in Model.ListCommandDetail)
            {
                <tr>
                    @foreach (var item1 in Model.ListCommand)
                    {
                        if (@item.CommandID == @item1.CommandID)
                        {
                            <td>
                                @foreach (var customer in Model.ListCustomer)
                                {
                                    if (item1.CustomerCode == customer.CustomerCode)
                                    {
                                        @customer.CustomerName
                                    }
                                }
                            </td>
                        }
                    }
                    <td>
                        @Html.DisplayFor(modelItem => item.Vehicle)
                    </td>
                    @foreach (var item1 in Model.ListCommand)
                    {
                        if (@item.CommandID == @item1.CommandID)
                        {
                            <td>
                                @item1.DriverName
                            </td>
                        }
                    }
                    <td>
                        @Convert.ToInt32(item.CertificateNumber)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.CardData)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.CardSerial)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ProductName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ArmNo)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.CompartmentOrder)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.V_Preset)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.V_Actual)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.AvgTemperature)
                    </td>



                    @if (item.Flag == Constants.Command_Flag_Register)
                    {
                        <td>
                            <div style="display:none">
                                @Html.DisplayFor(modelItem => item.Flag)
                            </div>
                            Đăng ký lệnh

                        </td>
                    }
                    else if (item.Flag == Constants.Command_Flag_Approved)
                    {
                        <td>
                            <div style="display:none">
                                @Html.DisplayFor(modelItem => item.Flag)
                            </div>
                            Đã duyệt lệnh
                        </td>
                    }
                    else if (item.Flag == Constants.Command_Flag_PrepareExport)
                    {
                        <td>
                            <div style="display:none">
                                @Html.DisplayFor(modelItem => item.Flag)
                            </div>
                            Chuẩn bị xuất
                        </td>
                    }
                    else if (item.Flag == Constants.Command_Flag_Exporting)
                    {
                        <td>
                            <div style="display:none">
                                @Html.DisplayFor(modelItem => item.Flag)
                            </div>
                            Đang xuất
                        </td>
                    }
                    else if (item.Flag == Constants.Command_Flag_Exported)
                    {
                        <td>
                            <div style="display:none">
                                @Html.DisplayFor(modelItem => item.Flag)
                            </div>
                            Xuất xong
                        </td>
                    }
                    else if (item.Flag == Constants.Command_Flag_StopPressing)
                    {
                        <td>
                            <div style="display:none">
                                @Html.DisplayFor(modelItem => item.Flag)
                            </div>
                            Dừng ép
                        </td>
                    }
                    else if (item.Flag == Constants.Command_Flag_InputCancel)
                    {
                        <td>
                            <div style="display:none">
                                @Html.DisplayFor(modelItem => item.Flag)
                            </div>
                            Hủy lệnh
                        </td>
                    }
                    else if (item.Flag == Constants.Command_Flag_InputHand)
                    {
                        <td>
                            <div style="display:none">
                                @Html.DisplayFor(modelItem => item.Flag)
                            </div>
                            Nhập tay
                        </td>
                    }
                    else if (item.Flag == Constants.Command_Flag_Seal)
                    {
                        <td>
                            <div style="display:none">
                                @Html.DisplayFor(modelItem => item.Flag)
                            </div>
                            Niêm chì
                        </td>
                    }
                    else if (item.Flag == Constants.Command_Flag_Invoice)
                    {
                        <td>
                            <div style="display:none">
                                @Html.DisplayFor(modelItem => item.Flag)
                            </div>
                            Đã in phiếu
                        </td>
                    }
                    @if (item.CommandFlag == Constants.COMMAND_FLAG_INIT || item.CommandFlag == null)
                    {
                        <td>
                            <div style="display:none">
                                @Html.DisplayFor(modelItem => item.CommandFlag)
                            </div>
                        </td>
                    }
                    else if (item.CommandFlag == Constants.COMMAND_FLAG_OLD)
                    {
                        <td>
                            <div style="display:none">
                                @Html.DisplayFor(modelItem => item.CommandFlag)
                            </div>
                            Lệnh cũ
                        </td>
                    }
                    else if (item.CommandFlag == Constants.COMMAND_FLAG_NEW)
                    {
                        <td>
                            <div style="display:none">
                                @Html.DisplayFor(modelItem => item.CommandFlag)
                            </div>
                            Lệnh mới
                        </td>
                    }

                    <td>
                        @if (item.Flag == Constants.Command_Flag_StopPressing && item.CommandFlag == Constants.COMMAND_FLAG_INIT)
                        {
                            <button type="button" onclick="GetEventValue(@item.ID);">Sửa</button>
                        }
                    </td>
                </tr>
            }
        </table>
        <div class="text-center">
            @Html.PagedListPager(Model.ListCommandDetail, page => Url.Action("Index", new
            {
                workOrder = Model.WorkOrder,
                cardSerial = Model.CardSerial,
                cardData = Model.CardData,
                verhicleNumber = Model.VerhicleNumber,
                startDate = Model.StartDate,
                endDate = Model.EndDate,
                status = Model.Status,
                certificateNumber = Model.CertificateNumber,
                page
            }))
        </div>
        <button id="Submit" class='btn btn-success' style="float:right">Lưu</button>
    </div>
}

<div id="warningcommanddetail" style="clear: both;">
</div>

@section scripts{
    <script>
        $('#datetimepicker1').datetimepicker({ format: 'DD/MM/YYYY HH:mm' });
        $('#datetimepicker2').datetimepicker({ format: 'DD/MM/YYYY HH:mm' });

        $("#checkAllCancel").click(function () {
            $('.checkIdCancel').not(this).prop('checked', this.checked);
        });
    </script>
    <script>

		$("#Submit").click(function () {
			// Cancel checkbox
			var selectedIDs = new Array();
			$('.checkIdCancel').each(function () {
				if ($(this).prop('checked')) {
					selectedIDs.push($(this).attr("id"));
				}
			});
			if (selectedIDs != null) {
				$.post("/CommandDetail/CancelCompartment", { lstId: selectedIDs })
					.done(function (msg) { })
					.fail(function (xhr, status, error) { });
			}
		});

        function GetEventValue(commanddetailid) {
            document.getElementById("warningcommanddetail").innerHTML = "";
            $.ajax({
                url: '/CommandDetail/GetAllById/',
                type: 'GET',
                data: {
                    "commanddetailid": commanddetailid
                },
                dataType: 'json',
                success: function (data) {
                    console.log(data);
                    var div = "";
					var k = 0;
					div += '<form action="/CommandDetail/RegisterCommandDetail" id="Form2" method="post">';
                    $.each(data, function (i, item) {
                        var timeorder = item.TimeOrder;
                        var nowtimeorder = new Date(parseInt(timeorder.substr(6)));
                        datetimeorder = new Date(nowtimeorder).toLocaleString();
                        console.log(data);
                        div += "<h4>Cập nhật lượng xuất (Nhập khi TĐH bị lỗi) </h4>";
                        div += "<div class='form-group col-xs-8' style='display:none'>";
                        div += "<input type='text' value=" + item.CommandID + " class='form-control' name='mCommandDetail[" + k + "].CommandID'>";
                        div += "<input type='text' value=" + item.CommandCode + " class='form-control' name='mCommandDetail[" + k + "].CommandCode'>";
                        div += "<input type='text' value=" + item.CommandType + " class='form-control' name='mCommandDetail[" + k + "].CommandType'>";
                        div += "<input type='text' value=" + item.WareHouseCode + " class='form-control' name='mCommandDetail[" + k + "].WareHouseCode'>";
                        div += "<input type='text' value=" + item.CardSerial + " class='form-control' name='mCommandDetail[" + k + "].CardSerial'>";
                        div += "<input type='text' value=" + item.ID + " class='form-control' name='mCommandDetail[" + k + "].ID'>";
                        div += "</div>";
                        div += "<div class='col-sm-4 col-xs-6'>";
                        div += "<div class='row'>";
                        div += "<label class='control-label col-xs-4'>Số phương tiện</label>";
                        div += "<div class='form-group col-xs-8'>";
                        div += "<input type='text' value=" + item.Vehicle + " class='form-control' name='mCommandDetail[" + k + "].Vehicle' readonly>";
                        div += "</div>";
                        div += "</div>";
                        div += "<div class='row'>";
                        div += "<label class='control-label col-xs-4'>Mã lệnh</label>";
                        div += "<div class='form-group col-xs-8'>";
                        div += "<input type='text' value=" + item.WorkOrder + " class='form-control' name='mCommandDetail[" + k + "].WorkOrder' readonly>";
                        div += "</div>";
                        div += "</div>";
                        //div += "<div class='row'>";
                        //div += "<label class='control-label col-xs-4'>Card Data</label>";
                        //div += "<div class='form-group col-xs-8'>";
                        //div += "<input type='text' value=" + item.CardData + " class='form-control' name='mCommandDetail[" + k + "].CardData' readonly>";
                        //div += "</div>";
                        //div += "</div>";
                        //div += "</div>";
                        div += "<div class='row'>";
                        div += "<label class='control-label col-xs-4'>Mã ngăn</label>";
                        div += "<div class='form-group col-xs-8'>";
                        div += "<input type='text' value=" + item.CompartmentOrder + " class='form-control' name='mCommandDetail[" + k + "].CompartmentOrder' readonly>";
                        div += "</div>";
                        div += "</div>";
                        div += "</div>";

                        div += "<div class='col-sm-4 col-xs-6'>";
                        div += "<div class='row'>";
                        div += "<label class='control-label col-xs-4'>Thời gian đăng ký </label>";
                        div += "<div class='form-group col-xs-8'>";
                        div += "<input type='text' value='" + datetimeorder + "' class='form-control' name='mCommandDetail[" + k + "].TimeOrder' readonly>";
                        div += "</div>";
                        div += "</div>";
                        div += "<div class='row'>";
                        div += "<label class='control-label col-xs-4'>Hàng hóa</label>";
                        div += "<div class='form-group col-xs-8'>";
                        div += "<input type='text' value=" + item.ProductName + " class='form-control' name='mCommandDetail[" + k + "].ProductName' readonly>";
                        div += "</div>";
                        div += "</div>";
      //                  div += "<div class='row'>";
      //                  div += "<label class='control-label col-xs-4'>Mã ngăn</label>";
      //                  div += "<div class='form-group col-xs-8'>";
      //                  div += "<input type='text' value=" + item.CompartmentOrder + " class='form-control' name='mCommandDetail[" + k + "].CompartmentOrder' readonly>";
      //                  div += "</div>";
      //                  div += "</div>";
						div += "</div>";

                        if (item.V_Actual == null) {
                            item.V_Actual = 0;
						}

                        div += "<div class='col-sm-4 col-xs-6'>";
                        div += "<div class='row'>";
                        div += "<label class='control-label col-xs-4'>Lượng đặt </label>";
                        div += "<div class='form-group col-xs-8'>";
                        div += "<input type='text' value=" + item.V_Preset + " class='form-control' id='V_Preset' readonly>";
                        div += "</div>";
                        div += "</div>";
                        div += "<div class='row'>";
                        div += "<label class='control-label col-xs-4'>Lượng xuất hiện tại</label>";
                        div += "<div class='form-group col-xs-8'>";
                        div += "<input type='number' value=" + item.V_Actual + " class='form-control' id='V_Actual' name='mCommandDetail[" + k + "].V_Actual' >";
                        div += "</div>";
                        div += "</div>";

                        div += "<div class='row'>";
                        div += "<label class='control-label col-xs-4'>Lượng xuất mới </label>";
                        div += "<div class='form-group col-xs-8'>";
                        div += "<input type='text' value=" + item.V_Preset + " class='form-control' id = 'V_Presetnew'  name='mCommandDetail[" + k + "].V_Preset' readonly>";

                        div += "</div>";
                        div += "<input type='submit' value='Lưu' class='btn btn-success' />";
                        div +=  "<input type='button' onclick='location.href='@Url.Action("CommandDetail")'' value='Hủy' class='btn btn-danger' />";
                        div += "</div>";
                        div += "</div>";

						k++;
					})
					div += "</form>";
                    document.getElementById("warningcommanddetail").innerHTML = div;
                    preset = parseInt(document.getElementById('V_Preset').value);
                    $("#V_Actual").bind("change on keyup", function () {
                        if (document.getElementById('V_Actual').value != "") {
                            actual = parseInt(document.getElementById('V_Actual').value);
                        }
                        if (actual <= preset ) {
                            presetnew = preset - actual;
                        }

                        else  {
                            alert("Lượng xuất hiện tại phải nhỏ hơn hoặc bằng Lượng đặt");

                        }

                        if (actual == null) {
                            presetnew = preset;
                        }
                        else {
                            document.getElementById('V_Presetnew').value = presetnew;
                        }
                    });

                },
                error: function (err) {
                    alert("Error: " + err.responseText);
                }
            });
        }
    </script>
}
